@model List<Corum.Models.Tender.RegisterFormFromContragents>
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="~/Scripts/bootstrap.bundle.min.js"></script>
    <script src="~/Scripts/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="~/Content/bootstrap.min.css">
    <link rel="stylesheet" href="~/Content/Tender/formFromContragents.css">
    <title>Форма запроса данных по транспортному средству</title>
</head>

<body style="width: 100%; height: auto; margin:0px;">
    <header class="headFromContr">
        <div class="logo-icon pull-left"></div>
    </header>
    <form action="">
        <div class="containTC">
            <div class="contTCOne">
                <p>Форма запроса данных по транспортному средству</p>
                @for(int i = 0; i < Model.Count; i++)
                {
                    <table class="tbFromContragents">
                        <caption class="captTC">ТС@(i+1)</caption>
                        <tbody>
                            <tr>
                                <th class="thMessCont tdThMessCont changeFontLink" colspan="2">
                                    <div class="divCollapse">
                                        <span class="changeFont" style="padding-top: 3px;">Информация по Заявке</span>
                                        <img id="imgCollapse" src="~/Content/images/pngwing.com.png" style="width: 18px; height: 18px;">
                                    </div>

                                    <table id="tbColapse" style="text-align: left; width: 98%; margin: 1%; border-collapse: separate;">
                                        <tbody>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">Заявка/номер</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">Тендер @Model[i].tenderNumber, Заявка @Model[i].orderId</td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">Тип перевозки</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">@Model[i].industryName</td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">Маршрут</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">@Model[i].routeShort</td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">Наименование груза/ Вес, т</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">@Model[i].nameCargo / @Model[i].weightCargo тн. </td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">Дата загрузки требуемая</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">@Model[i].dateDownloading.ToString("dd.MM.yyyy")</td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">Дата выгрузки требуемая</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">@Model[i].dateUnloading.ToString("dd.MM.yyyy")</td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">Описание</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">@Model[i].descriptionTender</td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">Кол-во транспортных средств акцептовано </th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">1</td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">Цена фрахт, без НДС/ТС</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">@Model[i].cost</td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">Отсрочка платежа, дней</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif;">@Model[i].DelayPayment</td>
                                            </tr>
                                            <tr>
                                                <th style="padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">Экспедитор</th>
                                                <td class="tdColl" style="margin-left: 2px; padding: 5px; font-size: 16px; font-family: 'Times New Roman', Times, serif; background-color: rgb(239, 125, 26);">@Model[i].contragentName</td>
                                            </tr>
                                        </tbody>
                                    </table>

                                </th>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">Марка авто<span class="redFont">*</span></th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" data-placement="auto" required title="Марка транспортного средства из
                                свидетельства регистрации транспортного средства" placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">Гос.номер ТС<span class="redFont">*</span></th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" data-placement="auto" required title="Номер регистрации транспортного средства
                                из свидетельства регистрации транспортного средства" placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">Гос.номер прицепа<span class="redFont">*</span></th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" data-placement="auto" required title="При отсутствии прицепа ставим «-»(дефис).
                                Номер регистрации прицепа из свидетельства регистрации транспортного средства/прицепа." placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">Грузоподъемность, т<span class="redFont">*</span></th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" data-placement="auto" required title="Грузоподъемность автомобиля" placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">Расстояние маршрута, км<span class="redFont">*</span></th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" required placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">ФИО водителя<span class="redFont">*</span></th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" data-placement="auto" required title="Ввести ФИО водителя транспортного средства." placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">№ телефона<span class="redFont">*</span></th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" data-placement="auto" required title="Ввести номер мобильного телефона водителя транспортного средства." placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">№ водительского удостоверения<span class="redFont">*</span></th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" data-placement="auto" required title="Ввести номер водительского удостоверения водителя транспортного средства." placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">Экспедитор</th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" value='@Model[i].contragentName' readonly>
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">Примечание</th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" data-placement="auto" title="Можете указать дополнительную информацию" placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">Пункт перехода гос.границы<span class="redFont">*</span></th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" required data-placement="auto" title="Указать Пункт перехода гос.границы для международных перевозок" placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">Серия, номер заграничного паспорта</th>
                                <td class="tdForm">
                                    <input class="inputTxt" type="text" data-toggle="tooltip" required data-placement="auto" title="Ввести номер заграничного паспорта водителя транспортного средства." placeholder="Введите данные">
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont changeFont" colspan="2">Скан.копии документов</th>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">- Сканкопия подписанной ЗАЯВКИ Экспедитором или заверенная КЭП/ЭЦП</th>
                                <td class="tdForm" data-toggle="tooltip" data-placement="auto" title="Вложите сканкопию или документ заверенный электронной цифровой подписью Экспедитора">
                                    <label for="inpFileOne" id="btnChooseOne" class="labBtn">Выбрать файл</label>
                                    <input id="inpFileOne" type="file" class="inpFile" multiple style="display: none;">
                                    <label id="labChooseOne" class="labChoose">Файл не выбран</label>
                                    <p class="parhChoose"></p>
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">- Сканкопия Свидетельство о регистрации ТС</th>
                                <td class="tdForm" data-toggle="tooltip" data-placement="auto" title="Вложите сканкопию Свидетельство о регистрации ТС">
                                    <label for="inpFileTwo" id="btnChooseTwo" class="labBtn">Выбрать файл</label>
                                    <input id="inpFileTwo" type="file" class="inpFile" style="display: none;" multiple>
                                    <label id="labChooseTwo" class="labChoose">Файл не выбран</label>
                                    <p class="parhChoose"></p>
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">- Сканкопия Загран. паспорта водителя</th>
                                <td class="tdForm" data-toggle="tooltip" data-placement="auto" title="Вложите сканкопию Загранпаспорта водителя">
                                    <label for="inpFileThree" id="btnChooseThree" class="labBtn">Выбрать файл</label>
                                    <input id="inpFileThree" type="file" class="inpFile" style="display: none;" multiple>
                                    <label id="labChooseThree" class="labChoose">Файл не выбран</label>
                                    <p class="parhChoose"></p>
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">- Сканкопия свидетельства о допуске ТС к перевозкам грузов под таможенными пломбами</th>
                                <td class="tdForm" data-toggle="tooltip" data-placement="auto" title="Вложите сканкопию свидетельства о допуске ТС к перевозкам грузов под таможенными пломбами">
                                    <label for="inpFileFour" id="btnChooseFour" class="labBtn">Выбрать файл</label>
                                    <input id="inpFileFour" type="file" class="inpFile" style="display: none;" multiple>
                                    <label id="labChooseFour" class="labChoose">Файл не выбран</label>
                                    <p class="parhChoose"></p>
                                </td>
                            </tr>
                            <tr>
                                <th class="thMessCont tdThMessCont">- Сканкопия Гражданского паспорта Перевозчика - собственника ТС для ФОП</th>
                                <td class="tdForm" data-toggle="tooltip" data-placement="auto" title="Вложите сканкопию Гражданского паспорта Перевозчика - собственника ТС для ФОП">
                                    <label for="inpFileFive" id="btnChooseFive" class="labBtn">Выбрать файл</label>
                                    <input id="inpFileFive" type="file" class="inpFile" style="display: none;" multiple>
                                    <label id="labChooseFive" class="labChoose">Файл не выбран</label>
                                    <p class="parhChoose"></p>
                                </td>
                            </tr>

                        </tbody>
                    </table>
                }

            </div>
            <div class="contTCTwo">
                <div class="chFromContr">
                    <input id="checkFronContragents" type="checkbox">
                    <label style="padding-left: 10px; font-size: 16px; font-weight: bold;" for="checkFronContragents" data-toggle="tooltip" data-placement="auto" title="Если есть необходимость обновить ранее отправленные данные по Заявке, то установить признак">Обновить ранее отправленные данные по Заявке</label>
                </div>
                <input id="submTC" class="btn btn-success" type="submit" value="Отправить">
            </div>
        </div>
    </form>

    <script>
        let inpChoose = document.getElementsByClassName('inpFile');
        let inpChooseBooferFiles = [new Array(), new Array(), new Array(), new Array(), new Array()];
        let flagCollapse = false;

        window.onload = function () {
            for (let i = 0; i < inpChoose.length; i++) {
                inpChoose[i].onchange = function handleFiles() {
                    let labChoose = document.getElementsByClassName('labChoose')[i];
                    let parhChoose = document.getElementsByClassName('parhChoose')[i];
                    let newFilelist;
                    if (inpChoose[i].files.length != 0) {
                        newFilelist = new DataTransfer();
                        const fileListArr = Array.from(inpChoose[i].files);
                        let fileOldLisrArr;
                        if (inpChooseBooferFiles[i].length != 0) {
                            fileOldLisrArr = Array.from(inpChooseBooferFiles[i]);
                            for (let el = 0; el < fileOldLisrArr.length; el++) {
                                let file = fileOldLisrArr[el];
                                newFilelist.items.add(file);
                            }
                        }
                        for (let el = 0; el < fileListArr.length; el++) {
                            let file = fileListArr[el];
                            newFilelist.items.add(file);
                        }
                        inpChoose[i].files = newFilelist.files;
                        inpChooseBooferFiles[i] = newFilelist.files;
                        parhChoose.innerHTML = '';
                        parhChoose.style.display = 'block';
                        let listLabCh = [];
                        let delBtnList = [];
                        for (let b = 0; b < inpChoose[i].files.length; b++) {
                            if (labChoose.outerText == "Файл не выбран") {
                                labChoose.style.display = 'none';
                            }
                            let delBtn = document.createElement('img');
                            delBtn.setAttribute('src', "/Content/images/del.png");
                            delBtn.setAttribute('style', 'width:13px; height:13px;')
                            delBtn.setAttribute('onclick', `DeleteFilePath(this)`);
                            delBtn.setAttribute(`data-form`, `${inpChoose[i].files[b].name}`);
                            delBtn.setAttribute(`data-form-id`, `${i}`);
                            delBtn.setAttribute(`data-form-idb`, `${b}`);
                            listLabCh.push(`${inpChoose[i].files[b].name}`);
                            delBtnList.push(delBtn);
                        }
                        for (let s = 0; s < listLabCh.length; s++) {
                            parhChoose.innerHTML += ` ${listLabCh[s]} ${delBtnList[s].outerHTML}<br>`;
                        }

                    }

                }
            }

            let imgCollapse = document.getElementById('imgCollapse');
            let tbCollapse = document.getElementById('tbColapse');

            imgCollapse.onclick = function () {
                if (flagCollapse) {
                    tbCollapse.style.display = 'table';
                } else {
                    tbCollapse.style.display = 'none';
                }
                flagCollapse = !flagCollapse;
            };

            $('[data-toggle="tooltip"]').tooltip();
        }

        function DeleteFilePath(e) {
            let i = Number(e.dataset.formId);
            let b = Number(e.dataset.formIdb);
            let nameForm = e.dataset.form;
            let labChoose = document.getElementsByClassName('labChoose')[i];

            if (inpChoose[i].files.length != 0) {
                let parhChoose = document.getElementsByClassName('parhChoose')[i];
                let listLabCh = [];
                let delBtnList = [];
                let delBtn;
                let newFilelist;

                const fileListArr = Array.from(inpChoose[i].files);
                console.log(fileListArr);


                if (inpChoose[i].files[b].name == nameForm) {
                    newFilelist = new DataTransfer();
                    for (let el = 0; el < inpChoose[i].files.length; el++) {
                        if (el == b) {
                            fileListArr.splice(b, 1);
                            continue;
                        }
                        let file = inpChoose[i].files[el];
                        newFilelist.items.add(file);
                    }
                }
                newFilelist.files = fileListArr;
                inpChoose[i].files = newFilelist.files;
                inpChooseBooferFiles[i] = newFilelist.files;
                if (inpChoose[i].files.length == 0) {
                    labChoose.style.display = 'initial';
                }

                for (b = 0; b < newFilelist.files.length; b++) {
                    let delBtn = document.createElement('img');
                    delBtn.setAttribute('src', "/Content/images/del.png");
                    delBtn.setAttribute('style', 'width:13px; height:13px;')
                    delBtn.setAttribute('onclick', `DeleteFilePath(this)`);
                    delBtn.setAttribute(`data-form`, `${newFilelist.files[b].name}`);
                    delBtn.setAttribute(`data-form-id`, `${i}`);
                    delBtn.setAttribute(`data-form-idb`, `${b}`);
                    listLabCh.push(`${newFilelist.files[b].name}`);
                    delBtnList.push(delBtn);
                }
                parhChoose.innerHTML = '';
                for (let s = 0; s < listLabCh.length; s++) {
                    parhChoose.innerHTML += ` ${listLabCh[s]} ${delBtnList[s].outerHTML}<br>`;
                }

            }
        };
    </script>
</body>

</html>